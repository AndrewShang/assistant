---

copyright:
  years: 2015, 2018
lastupdated: "2018-01-30"

---

{:shortdesc: .shortdesc}
{:new_window: target="_blank"}
{:tip: .tip}
{:pre: .pre}
{:codeblock: .codeblock}
{:screen: .screen}
{:javascript: .ph data-hd-programlang='javascript'}
{:java: .ph data-hd-programlang='java'}
{:python: .ph data-hd-programlang='python'}
{:swift: .ph data-hd-programlang='swift'}

# エンティティーの定義

***エンティティー***とは、ユーザーのある目的に関連した、オブジェクトのクラスまたはデータ・タイプを表しています。 ユーザーの入力によって示されたエンティティーを認識することで、{{site.data.keyword.conversationshort}} サービスは、インテントを実行するのに必要な特定のアクションを選択できます。

<iframe class="embed-responsive-item" id="youtubeplayer" type="text/html" width="640" height="390" src="https://www.youtube.com/embed/kAZ9m-oCKxM" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen> </iframe>

## エンティティーの制限
{: #entity-limits}

作成できるエンティティーの数、エンティティー値の数、同義語の数は、{{site.data.keyword.conversationshort}} のサービス・プランに応じて異なります。

| サービス・プラン      | 1 ワークスペースあたりのエンティティーの数 | 1 ワークスペースあたりのエンティティーの値 | 1 ワークスペースあたりのエンティティーの同義語の数 |
|-------------------|-----------------------:|----------------------------:|--------------------------------:|
| 標準/プレミアム |                          1000 |                            100,000 |                              100,000 |
| ライト              |                            25 |                            100,000 |                              100,000 |

使用可能にしたシステム・エンティティーは、プラン使用量合計に加算されます。

## エンティティーの作成
{: #creating-entities}

{{site.data.keyword.conversationshort}} ツールを使用してエンティティーを作成します。

1.  {{site.data.keyword.conversationshort}} ツールでワークスペースを開き、**「Entities」**タブをクリックします。 **「Entities」**が表示されていない場合は、![メニュー](images/Menu_16.png) メニューを使用してページを開きます。

1.  **「エンティティーの追加 (Add entity)」**をクリックします。

    または、**「Use System Entities」**をクリックして、{{site.data.keyword.IBM_notm}} 提供の共通エンティティーのリストから選択することもできます。それらのエンティティーは、どのようなユース・ケースにも適用可能です。 詳しくは、[システム・エンティティーの有効化](#enable_system_entities)を参照してください。

1.  **「エンティティー名 (Entity name)」**フィールドに、このエンティティーを表す名前を入力します。

    エンティティー名には、文字 (ユニコード)、数字、下線、ハイフンを使用できます。 例えば次のようにします。
    - `@location`
    - `@menu_item`
    - `@product`

    {{site.data.keyword.conversationshort}} ツールでエンティティー名を作成するときには、エンティティー名に `@` 文字を含めないでください。 エンティティー名は、スペースを含んではならず、64 文字を超えてはなりません。 またエンティティー名の先頭にストリング `sys-` を付けることはできません。このストリングはシステム・エンティティー用に予約済みです。
    {: tip}

1.  **「エンティティーの作成 (Create entity)」**を選択します。

    ![エンティティーの作成を示す画面キャプチャー](images/create_entity.png)

1.  **「値の名前 (Value name)」**フィールドに、エンティティーに対して指定できる値のテキストを入力して、`Enter` キーを押します。エンティティー値には、最大で 64 文字までの任意のストリングを使用できます。

    > **重要:** エンティティーの名前と値には、機密情報や個人情報を含めないでください。 それらの名前や値は、アプリの URL として露出する可能性があります。

1.  **「Fuzzy Matching」**は、ボタンをクリックしてオンまたはオフのいずれかを選択します。ファジー・マッチングはデフォルトでオフです。 この機能は、[サポートされる言語](lang-support.html)トピックに示された言語で使用可能です。
 {: #fuzzy-matching}

    ファジー・マッチングをオンにすると、完全一致していなくてもエンティティーに類似した構文のユーザー入力語を認識するようになり、サービスの能力が高まります。 ファジー・マッチングは、ステミング、ミススペル、部分一致の 3 つの要素からなります。
    - *ステミング* - 文法的にさまざまな語形を取るエンティティー値の、語幹の形式を識別します。 例えば、「bananas」の語幹は「banana」、「running」の語幹は「run」などとなります。
    - *ミススペル* - つづりの誤りや構文上の微妙な違いがあっても、対応する適切なエンティティーにユーザー入力をマップすることができます。 例えば、*giraffe* を動物のエンティティーの同義語として定義したときに、*giraffes* や *girafe* という用語がユーザー入力に含まれる場合、ファジー・マッチングによって、その用語を動物のエンティティーに適切にマップできます。
    - *部分一致* - 部分一致により、ユーザー定義エンティティーに存在する、サブストリングに基づいた同義語を自動的に提案します。そして、エンティティーの完全一致と比較して、それより低い信頼性スコアを割り当てます。

    **注** - 英語のファジー・マッチングでは、一般的で有効な英単語のいくつかは、特定のエンティティーのファジー・マッチとして取り込まれません。 この機能は、標準的な英語の辞書の単語を使用します。英語のエンティティー値/同義語を定義することもできます。この場合、ファジー・マッチングは、定義したエンティティー値/同義語のみとマッチングされます。例えば、ファジー・マッチングでは用語 `unsure` と `insurance` がマッチングされる可能性がありますが、`unsure` を `@option` のようなエンティティーの値/同義語として定義すると、`unsure` は `insurance` とはマッチングされず、常に `@option` とマッチングされます。

1.  値の名前を入力したら、そのエンティティー値について、同義語を追加したり特定のパターンを定義したりできます。これを行うには、*「タイプ」*ドロップダウン・メニューから`「同義語 (Synonyms)」`または`「パターン (Patterns)」`を選択します。

    ![「Value」の「Type」セレクター](images/value_type.png)

    > **注:** 1 つのエンティティー値に対して、同義語またはパターンの*どちらか一方*を追加できます。両方を追加することはできません。

    - **「Synonyms」**フィールドに、エンティティー値の同義語を入力します。 同義語として、最大で 64 文字までの任意のストリングを使用できます。

      ![エンティティーの定義を示す画面キャプチャー](images/define_entity.png)

    - **「Patterns」**フィールドでは、エンティティー値に対して特定のパターンを定義できます。 パターンは**必ず**、正規表現としてフィールドに入力してください。

      ![パターン・エンティティーを定義する画面キャプチャー](images/patternents1.png)
      {: #pattern-entities}

      この例では、エンティティー *ContactInfo* について、電話番号、E メール、Web サイトの値のパターンを以下のように定義できます。
      - 電話番号
        - `localPhone`: `(\d{3})-(\d{4})`。例: 426-4968
        - `fullUSphone`: `(\d{3})-(\d{3})-(\d{4})`。例: 800-426-4968
        - `internationalPhone`: `^(\(?\+?[0-9]*\)?)?[0-9_\- \(\)]*$`。例: +44 1962 815000
      - `email`: `\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b`。例: name@ibm.com
      - `website`: `(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$`。例: https://www.ibm.com

      パターン・エンティティーを使用する場合はたいてい、対話ツリー内から、コンテキスト変数 (またはアクション変数) に、パターンと一致するテキストを格納する必要があります。

      これから、ユーザーに E メール・アドレスを要求するケースを検討します。 対話ノード条件には、`@contactInfo:email` のような条件が入ります。 ユーザーが入力した E メールをコンテキスト変数として割り当てるには、以下の構文を使用して、対話ノードの応答セクション内でパターン・マッチを取り込むことができます。

      ```json
      {
          "context" : {
              "email": "<? @contactInfo.literal ?>"
          }
      }
      ```
      {: screen}
      {: #capture-group}

      *グループの取り込み* - 正規表現の場合、パターンの普通の括弧に囲まれた部分は、1 つのグループとして取り込まれます。例えば、エンティティー値 `fullUSphone` には、以下の 3 つのグループが取り込まれて含まれています。

        - `(\d{3})` - 米国の市外局番
        - `(\d{3})` - 接頭部
        - `(\d{4})` - 回線番号

      グループ化が役立つ可能性がある場合の例としては、{{site.data.keyword.conversationshort}} サービスがユーザーに電話番号を尋ねた後、応答でユーザーから提供された番号の市外局番のみを使用するようにしたい場合などがあります。

      ユーザーが入力した市外局番をコンテキスト変数として割り当てるには、以下の構文を使用して、ダイアログ・ノードの応答セクション内でそのグループと一致するものを取り込むことができます。

        ```json
        {
            "context" : {
                "area_code": "<? @fullUSphone.groups[1] ?>"
            }
        }
        ```
       {: screen}

      ダイアログ実行時のグループの取り込みの使用法に関する追加情報については、[コンテキスト変数へのパターン・エンティティー値の保管](dialog-overview-context-groups.html)を参照してください。

      {{site.data.keyword.conversationshort}} サービスで使用されるパターン・マッチング・エンジンには、構文上の制約がいくつかあります。これらの制約は、他の正規表現エンジンを使用するときに生じる可能性がある、パフォーマンス上の問題を回避するために必要です。
        - 以下の内容をエンティティー・パターンに含めることはできません。
          - 正の反復 (例: `x*+`)
          - 逆参照 (例: `\g1`)
          - 条件付きブランチ (例: `(?(cond)true)`)
        - パターン・エンティティーの先頭または末尾が Unicode 文字で、ワード境界 (`\bš\b` など) が含まれている場合、パターン・マッチングはワード境界と正確に一致しません。この例では、入力が `š zkouška` の場合、マッチングにより `Group 0: 6-7 š` (`š zkou`_**`š`**_`ka`) が返され、正しい結果である `Group 0: 0-1 š` (_**`š`**_ `zkouška`) は返されません。

      正規表現エンジンは、Java 正規表現エンジンにおおまかに基づいています。 サポートされないパターンを API によって、または {{site.data.keyword.conversationshort}} サービスのツール UI 内からアップロードしようとすると、{{site.data.keyword.conversationshort}} サービスはエラーを生成します。

1.  **「値の追加 (Add value)」**をクリックしてプロセスを繰り返すことで、さらにエンティティー値を追加します。

1.  エンティティー値の追加が終了したら、![閉じる矢印](images/close_arrow.png) を選択してエンティティーの作成を終了します。

### 結果

作成したエンティティーが**「Entities」**タブに追加され、新規データについてのシステムのトレーニングが開始されます。

## エンティティーの編集

リスト内の任意のエンティティーをクリックして開き、編集することができます。 エンティティーをリネームまたは削除したり、値、同義語、パターンを追加、編集、削除したりできます。

> **注**: エンティティー・タイプを `synonym` から `pattern` に変更したりその逆に変更したりすると、既存の値は変換されますが、そのままでは役立たない可能性があります。

## エンティティーの検索

検索機能を使用して、エンティティー名、値、同義語を検索します。

1.  ナビゲーション・バーで**「エンティティー (Entities)」**タブを選択してから、*エンティティー「マイ・エンティティー (My Entities)」*を選択します。

    ![「エンティティー (Entities)」タブの概要](images/entity_oview.png)

    **注**: システム・エンティティーは検索できません。

1.  「検索」アイコン ![「検索」アイコン](images/search_icon.png) を選択します。

1.  検索対象の語句を入力します。

    ![エンティティー検索の語](images/searchent_1.png)

    **注**: 初めて検索する際には、索引が作成されます。コンテンツの索引付けが行われている間、終わるまで待つように促すメッセージが表示される場合があります。

### 結果

検索語が含まれるエンティティーと、対応する例が表示されます。任意の結果を選択して、編集するために開きます。

  ![エンティティー検索の戻り](images/searchent_2.png)

## エンティティーのインポート

多数のエンティティーがある場合、{{site.data.keyword.conversationshort}} ツールで 1 つずつ定義するよりも、コンマ区切り値 (CSV) ファイルからインポートする方が簡単です。

1.  エンティティーを CSV ファイルにまとめるか、またはスプレッドシート内のエンティティーを CSV ファイルにエクスポートします。 ファイルの各行のフォーマットは、以下のようにする必要があります。

    ```
    <entity>,<value>,<synonyms>
    ```
    {: screen}

    ここで、&lt;entity&gt; はエンティティーの名前で、&lt;value&gt; はエンティティーの値で、&lt;synonyms&gt; はその値の同義語からなるコンマ区切りリストです。

    ```
    weekday,Monday,Mon
    weekday,Tuesday,Tue,Tues
    weekday,Wednesday,Wed
    weekday,Thursday,Thur,Thu,Thurs
    weekday,Friday,Fri
    weekday,Saturday,Sat
    weekday,Sunday,Sun
    month,January,Jan
    month,February,Feb
    month,March,Mar
    month,April,Apr
    month,May
    ```
    {: screen}

    CSV ファイルをインポートする際には、パターンもサポートされます。`/` で囲まれたストリングは、(同義語ではなく) パターンと見なされます。

    ```
    ContactInfo,localPhone,/(\d{3})-(\d{4})/
    ContactInfo,fullUSphone,/(\d{3})-(\d{3})-(\d{4})/
    ContactInfo,internationalPhone,/^(\(?\+?[0-9]*\)?)?[0-9_\- \(\)]*$/
    ContactInfo,email,/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b/
    ContactInfo,website,/(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/
    ```
    {: screen}

    CSV ファイルは、バイト・オーダー・マーク (BOM) を付加せず、UTF-8 エンコードで保存します。 CSV ファイルの最大サイズは 10MB です。 CSV ファイルがこれより大きい場合は、複数のファイルに分割し、別々にインポートすることを検討してください。  {{site.data.keyword.conversationshort}} ツールでワークスペースを開き、**「Entities」**タブをクリックします。
    {: tip}

1.  ![Import](images/importGA.png) をクリックしてから、ファイルをドラッグするか、またはコンピューターにあるファイルを参照して選択します。 ファイルは検証されてインポートされます。そして、新規データについてのシステムのトレーニングが開始されます。

### 結果

「Entities」タブで、インポートされたエンティティーを表示できます。 新しいエンティティーを表示するために、ページの最新表示が必要な場合もあります。

## エンティティーのエクスポート
{: #export_entities}

多数のエンティティーを CSV ファイルにエクスポートすることで、それらのエンティティーを別の {{site.data.keyword.conversationshort}} アプリケーションにインポートして再使用できるようになります。

CSV ファイルをエクスポートする際には、パターンもサポートされます。`/` で囲まれたストリングは、(同義語ではなく) パターンと見なされます。
{: tip}

1.  対象のエンティティーを選択してから、**「エクスポート」**を選択します。

    ![エンティティーのエクスポート・ボタン](images/ExportEntity.png)

## エンティティーの削除
{: #delete_entities}

複数のエンティティーを選択して、削除することができます。

**重要**: エンティティーを削除すると、関連付けられたすべての値、同義語、またはパターンも削除され、それらの項目を後で取り出すことができなくなります。 それらのエンティティーまたは値を参照しているすべての対話ノードについては、削除されたコンテンツを今後参照することがないように、手動で更新する必要があります。

1.  対象のエンティティーを選択してから、**「削除」**を選択します。

    ![エンティティーの削除ボタン](images/DeleteEntity.png)

## システム・エンティティーの有効化
{: #enable_system_entities}

{{site.data.keyword.conversationshort}} サービスには、どのアプリケーションでも使用できる共通エンティティーである、*システム・エンティティー* が多数用意されています。 システム・エンティティーを有効にすると、多くのユース・ケースに共通のトレーニング・データを、ワークスペースに迅速に取り込むことができます。

システム・エンティティーを使用すると、それらのエンティティーが表すオブジェクト・タイプの、広範囲の値を認識することができます。 例えば、`@sys-number` システム・エンティティーは、単語として表記された数字も含め、整数、小数など、あらゆる数値と一致します。

システム・エンティティーは一元的に管理されているため、更新内容は自動的に使用できるようになります。 システム・エンティティーを変更することはできません。

1.  「Entities」タブで**「System entities」**をクリックします。

    !["System entities" タブの画面キャプチャー](images/system_entities_1.png)

1.  システム・エンティティーのリストを参照して、対象のアプリケーションで役立つものを選択します。
    - 一致する入力データの例を含め、システム・エンティティーに関する詳細情報を表示するには、リスト内のエンティティーをクリックします。
    - 使用できるシステム・エンティティーについて詳しくは、[システム・エンティティー](system-entities.html)を参照してください。

1.  各システム・エンティティーの横にある切り替えスイッチをクリックすると、有効または無効にできます。

### 結果

システム・エンティティーを有効にした後、{{site.data.keyword.conversationshort}} サービスはリトレーニングを開始します。 トレーニングが完了したら、エンティティーを使用できるようになります。
